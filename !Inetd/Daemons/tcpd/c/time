#include <stdlib.h>
#include <string.h>
#include <stdio.h>
#include <time.h>
#include "kernel.h"
#include "syslog.h"
#include "sys/types.h"
#include "sys/socket.h"
#include "sys/errno.h"
#include "sys/syslog.h"
#include "socklib.h"
#include "unixlib.h"

#define BUFFERSIZE     128
#define SERVICE        "Time"
#define UNIXEPOCH      2208988800ul
#define NOSOCK         -1
#define DAEMON         "DaemonLog"

static char *copyright="Time tcp version 0.01 ©Bill Antonia 2 July 1998";

int main(int argc,char *argv[])
{
  int sock=NOSOCK;
  _kernel_oserror *err;
  int cc;
  char buf[BUFFERSIZE];
  time_t now;
  copyright=copyright;
  syslogf(DAEMON,LOG_INFO,"%s tcp starting",SERVICE);
  sock=atoi(argv[1]);
  (void)time(&now);
  now=(time_t)htonl((unsigned int)(now+2208988800));
  if ((cc=socketwrite(sock, buf, strlen(buf)))==-1)
    syslogf(DAEMON,LOG_ERR,"%s tcp error: %x %s",SERVICE,err->errnum,err->errmess);
  if (socketclose(sock)==-1)
    syslogf(DAEMON,LOG_ERR,"%s tcp error: %x %s",SERVICE,err->errnum,err->errmess);
  syslogf(DAEMON,LOG_INFO,"%s tcp ending",SERVICE);
  syslog_logcomplete(DAEMON);
  return 0;
}
